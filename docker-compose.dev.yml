version: '3'

services:
  shop_redisinsight:
    container_name: shop_redisinsight
    image: redislabs/redisinsight:latest
    ports:
      - 8001:8001
    networks:
      - shop-network

  shop_back:
    volumes:
     - ./shop_back/dist/src:/app/src
     - ./shop_back/dist/config:/app/config
     - ./shop_back/dist/migrations:/app/migrations
     - ./shop_back/dist/templates:/app/templates
    ports:
     - "9003:9003"
    environment:
      - PHP_DEBUGGER=xdebug
      - XDEBUG_MODE=debug
      - XDEBUG_CLIENT_HOST=host.docker.internal
      - XDEBUG_CLIENT_PORT=9003
      - XDEBUG_IDE_KEY=PHP_IDE_CONFIG
    networks:
      - local-db-network

  queue-consumer:
    volumes:
      - ./shop_back/dist/src:/app/src
      - ./shop_back/dist/migrations:/app/migrations
    networks:
      - local-db-network

  shop_migrations:
    networks:
      - local-db-network

networks:
  local-db-network:
    name: local-db-network
    external: true
